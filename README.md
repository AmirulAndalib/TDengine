<p align="center">
  <a href="https://tdengine.com" target="_blank">
  <img
    src="docs/assets/tdengine.svg"
    alt="TDengine"
    width="500"
  />
  </a>
</p>

[![GitHub Actions Workflow Status](https://img.shields.io/github/actions/workflow/status/taosdata/tdengine/taosd-ci-build.yml)](https://github.com/taosdata/TDengine/actions/workflows/taosd-ci-build.yml)
[![Coverage Status](https://coveralls.io/repos/github/taosdata/TDengine/badge.svg?branch=3.0)](https://coveralls.io/github/taosdata/TDengine?branch=3.0)
![GitHub commit activity](https://img.shields.io/github/commit-activity/m/taosdata/tdengine)
<br />
![GitHub Release](https://img.shields.io/github/v/release/taosdata/tdengine)
![GitHub License](https://img.shields.io/github/license/taosdata/tdengine)
[![CII Best Practices](https://bestpractices.coreinfrastructure.org/projects/4201/badge)](https://bestpractices.coreinfrastructure.org/projects/4201)
<br />
[![Twitter Follow](https://img.shields.io/twitter/follow/tdenginedb?label=TDengine&style=social)](https://twitter.com/tdenginedb)
[![YouTube Channel](https://img.shields.io/badge/Subscribe_@tdengine--white?logo=youtube&style=social)](https://www.youtube.com/@tdengine)
[![Discord Community](https://img.shields.io/badge/Join_Discord--white?logo=discord&style=social)](https://discord.com/invite/VZdSuUg4pS)
[![LinkedIn](https://img.shields.io/badge/Follow_LinkedIn--white?logo=linkedin&style=social)](https://www.linkedin.com/company/tdengine)
[![StackOverflow](https://img.shields.io/badge/Ask_StackOverflow--white?logo=stackoverflow&style=social&logoColor=orange)](https://stackoverflow.com/questions/tagged/tdengine)

English | [简体中文](README-CN.md) | [TDengine Cloud](https://cloud.tdengine.com) | [Learn more about TSDB](https://tdengine.com/tsdb/)

# Table of Contents

1. [Introduction](#1-introduction)
1. [Documentation](#2-documentation)
1. [Prerequisites](#3-prerequisites)
1. [Building](#4-building)
1. [Packaging](#5-packaging)
1. [Installation](#6-installation)
1. [Running](#7-running)
1. [Testing](#8-testing)
1. [Releasing](#9-releasing)
1. [CI/CD](#10-cicd)
1. [Coverage --replace](#11-coverage---replace)
1. [Contributing](#12-contributing)

# 1. Introduction

TDengine is an open source, high-performance, cloud native [time-series database](https://tdengine.com/tsdb/) optimized for Internet of Things (IoT), Connected Cars, and Industrial IoT. It enables efficient, real-time data ingestion, processing, and monitoring of TB and even PB scale data per day, generated by billions of sensors and data collectors. TDengine differentiates itself from other time-series databases with the following advantages:

- **[High Performance](https://tdengine.com/tdengine/high-performance-time-series-database/)**: TDengine is the only time-series database to solve the high cardinality issue to support billions of data collection points while out performing other time-series databases for data ingestion, querying and data compression.

- **[Simplified Solution](https://tdengine.com/tdengine/simplified-time-series-data-solution/)**: Through built-in caching, stream processing and data subscription features, TDengine provides a simplified solution for time-series data processing. It reduces system design complexity and operation costs significantly.

- **[Cloud Native](https://tdengine.com/tdengine/cloud-native-time-series-database/)**: Through native distributed design, sharding and partitioning, separation of compute and storage, RAFT, support for kubernetes deployment and full observability, TDengine is a cloud native Time-Series Database and can be deployed on public, private or hybrid clouds.

- **[Ease of Use](https://tdengine.com/tdengine/easy-time-series-data-platform/)**: For administrators, TDengine significantly reduces the effort to deploy and maintain. For developers, it provides a simple interface, simplified solution and seamless integrations for third party tools. For data users, it gives easy data access.

- **[Easy Data Analytics](https://tdengine.com/tdengine/time-series-data-analytics-made-easy/)**: Through super tables, storage and compute separation, data partitioning by time interval, pre-computation and other means, TDengine makes it easy to explore, format, and get access to data in a highly efficient way.

- **[Open Source](https://tdengine.com/tdengine/open-source-time-series-database/)**: TDengine’s core modules, including cluster feature, are all available under open source licenses. It has gathered 19.9k stars on GitHub. There is an active developer community, and over 139k running instances worldwide.

For a full list of TDengine competitive advantages, please [check here](https://tdengine.com/tdengine/). The easiest way to experience TDengine is through [TDengine Cloud](https://cloud.tdengine.com).

# 2. Documentation

For user manual, system design and architecture, please refer to [TDengine Documentation](https://docs.tdengine.com) ([TDengine 文档](https://docs.taosdata.com))

# 3. Prerequisites

List the software and tools required to work on the project.

  - go 1.20+ (for taosadapter)
  - node 16.20.2 (for taos-explorer)
  - python 3.10.12+ (for test)

Step-by-step instructions to set up the prerequisites software.

#### Install dependencies tools

  - The required package for linux

    ```bash
    apt-get install -y llvm gcc make cmake libssl-dev pkg-config perl g++ lzma curl locales psmisc sudo tree libgeos-dev libgflags2.2 libgflags-dev libgoogle-glog-dev libjansson-dev libsnappy-dev liblzma-dev libz-dev zlib1g build-essential valgrind rsync vim libjemalloc-dev openssh-server screen sshpass net-tools dirmngr gnupg apt-transport-https ca-certificates software-properties-common  r-base iputils-ping
    ```

    Install Go for linux

    Update the installation package to version 1.23.3.

    ```bash
    cd /usr/local/
    wget https://golang.google.cn/dl/go1.23.3.linux-amd64.tar.gz
    rm -rf /usr/local/go && tar -C /usr/local -xzf go1.23.3.linux-amd64.tar.gz
    ```

    Set up environment variables, first add the following content to the end of the `~/.bashrc` file.

    ```bash
    export GO_HOME=/usr/local/go
    export PATH=$GO_HOME/bin:$PATH
    export CGO_ENABLED=1
    ```

    Then make the environment variables take effect.

    ```bash
    source ~/.bashrc
    ```

    Configure proxy to accelerate the download of Go dependencies.

    ```bash
    go env -w GOPROXY=https://goproxy.cn,direct
    go env -w GO111MODULE=on
    ```

    Check if the environment variables have taken effect and if the version is the installed version.

    ```bash
    go env
    go version
    ```

    Install node for linux

    Recommend install node using nvm.

    ```bash
    curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash
    ```

    Set up environment variables, add the following content to the end of the `~/.bashrc` file.

    ```bash
    export NVM_DIR="$HOME/.nvm"
    [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
    ```

      Then make the environment variables take effect.

      ```bash
      source ~/.bashrc
      ```

      Finally, Install node and yarn.

      ```bash
      nvm install 16.20.2
      npm config set registry=https://registry.npmmirror.com
      npm install -g yarn
      ```

      Install Python-connector for linux

      Install Python3.

      ```bash
      apt install python3
      apt install python3-pip
      ```

      Install the dependent Python components.

      ```bash
      pip3 install pandas psutil fabric2 requests faker simplejson toml pexpect tzlocal distro decorator loguru hyperloglog
      ```

      Install the Python connector for TDengine.

      ```bash
      pip3 install taospy taos-ws-py
      ```

  - The required package for windows

      to be updated...

  - The required package for macOS

      ```
      brew install argp-standalone gflags pkgconfig
      ```

#### Get the source codes

  First of all, you may clone the source codes from github:

  ```bash
  git clone https://github.com/taosdata/TDengine.git
  cd TDengine
  ```

  You can modify the file ~/.gitconfig to use ssh protocol instead of https for better download speed. You will need to upload ssh public key to GitHub first. Please refer to GitHub official documentation for detail.

  ```
  [url "git@github.com:"]
      insteadOf = https://github.com/
  ```

#### Special Note
  [JDBC Connector](https://github.com/taosdata/taos-connector-jdbc)， [Go Connector](https://github.com/taosdata/driver-go)，[Python Connector](https://github.com/taosdata/taos-connector-python)，[Node.js Connector](https://github.com/taosdata/taos-connector-node)，[C# Connector](https://github.com/taosdata/taos-connector-dotnet) ，[Rust Connector](https://github.com/taosdata/taos-connector-rust) and [Grafana plugin](https://github.com/taosdata/grafanaplugin) has been moved to standalone repository.

# 4. Building

At the moment, TDengine server supports running on Linux/Windows/MacOS systems. Any application can also choose the RESTful interface provided by taosAdapter to connect the taosd service. TDengine supports X64/ARM64 CPU, and it will support MIPS64, Alpha64, ARM32, RISC-V and other CPU architectures in the future. Right now we don't support build with cross-compiling environment.

You can choose to install through source code, [container](https://docs.tdengine.com/get-started/docker/), [installation package](https://docs.tdengine.com/get-started/package/) or [Kubernetes](https://docs.tdengine.com/deployment/k8s/). This quick guide only applies to installing from source.

TDengine provide a few useful tools such as taosBenchmark (was named taosdemo) and taosdump. They were part of TDengine. By default, TDengine compiling does not include taosTools. You can use `cmake .. -DBUILD_TOOLS=true` to make them be compiled with TDengine.

To build TDengine, use [CMake](https://cmake.org/) 3.13.0 or higher versions in the project directory.

- Linux platform building

  You can run the bash script `build.sh` to build both TDengine and taosTools including taosBenchmark and taosdump as below:

  ```bash
  ./build.sh
  ```

  It equals to execute following commands:

  ```bash
  mkdir debug
  cd debug
  cmake .. -DBUILD_TOOLS=true -DBUILD_CONTRIB=true
  make
  ```

  You can use Jemalloc as memory allocator instead of glibc:

  ```
  apt install autoconf
  cmake .. -DJEMALLOC_ENABLED=true
  ```

  TDengine build script can detect the host machine's architecture on X86-64, X86, arm64 platform.
  You can also specify CPUTYPE option like aarch64 too if the detection result is not correct:

  aarch64:

  ```bash
  cmake .. -DCPUTYPE=aarch64 && cmake --build .
  ```

- Windows platform building

  If you use the Visual Studio 2013, please open a command window by executing "cmd.exe".
  Please specify "amd64" for 64 bits Windows or specify "x86" for 32 bits Windows when you execute vcvarsall.bat.

  ```cmd
  mkdir debug && cd debug
  "C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat" < amd64 | x86 >
  cmake .. -G "NMake Makefiles"
  nmake
  ```

  If you use the Visual Studio 2019 or 2017:

  please open a command window by executing "cmd.exe".
  Please specify "x64" for 64 bits Windows or specify "x86" for 32 bits Windows when you execute vcvarsall.bat.

  ```cmd
  mkdir debug && cd debug
  "c:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvarsall.bat" < x64 | x86 >
  cmake .. -G "NMake Makefiles"
  nmake
  ```

  Or, you can simply open a command window by clicking Windows Start -> "Visual Studio < 2019 | 2017 >" folder -> "x64 Native Tools Command Prompt for VS < 2019 | 2017 >" or "x86 Native Tools Command Prompt for VS < 2019 | 2017 >" depends what architecture your Windows is, then execute commands as follows:

  ```cmd
  mkdir debug && cd debug
  cmake .. -G "NMake Makefiles"
  nmake
  ```

- MacOS platform building

  Please install XCode command line tools and cmake. Verified with XCode 11.4+ on Catalina and Big Sur.

  ```shell
  mkdir debug && cd debug
  cmake .. && cmake --build .
  ```

# 5. Packaging

To be updated...

# 6. Installation

- Linux platform installation

  After building successfully, TDengine can be installed by

  ```bash
  sudo make install
  ```

  Users can find more information about directories installed on the system in the [directory and files](https://docs.tdengine.com/reference/directory/) section.

  Installing from source code will also configure service management for TDengine.Users can also choose to [install from packages](https://docs.tdengine.com/get-started/deploy-from-package/) for it.

- Windows platform installation

  After building successfully, TDengine can be installed by:

  ```cmd
  nmake install
  ```

- MacOS platform installation

  After building successfully, TDengine can be installed by:

  ```bash
  sudo make install
  ```

# 7. Running

- To start the service after installation on linux, in a terminal, use:

  ```bash
  sudo systemctl start taosd
  ```

  Then users can use the TDengine CLI to connect the TDengine server. In a terminal, use:

  ```bash
  taos
  ```

  If TDengine CLI connects the server successfully, welcome messages and version info are printed. Otherwise, an error message is shown.

  If you don't want to run TDengine as a service, you can run it in current shell. For example, to quickly start a TDengine server after building, run the command below in terminal: (We take Linux as an example, command on Windows will be `taosd.exe`)

  ```bash
  ./build/bin/taosd -c test/cfg
  ```

  In another terminal, use the TDengine CLI to connect the server:

  ```bash
  ./build/bin/taos -c test/cfg
  ```

  option "-c test/cfg" specifies the system configuration file directory.

- To start the service after installation on windows, in a terminal, use:

  ```bash
  to be updated
  ```
  Then users can use the TDengine CLI to connect the TDengine server. In a terminal, use:

  ```bash
  to be updated
  ```

- To start the service after installation on macOS, double-click the /applications/TDengine to start the program, or in a terminal, use:

  ```bash
  sudo launchctl start com.tdengine.taosd
  ```

  Then users can use the TDengine CLI to connect the TDengine server. In a terminal, use:

  ```bash
  taos
  ```

If TDengine CLI connects the server successfully, welcome messages and version info are printed. Otherwise, an error message is shown.

# 8. Testing

- Run the TSIM test script

  TSIM test framework is developed by c++ in the start-up period of TDengine， the test scripts are basic cases, you can run 
  the script with below command:

  ```bash
  cd /root/TDengine/tests/script
  ./test.sh -f tsim/db/basic1.sim
  ```

- Run the Python test script
  
  Python test script includes almost all of the functions of TDengine, so some test case maybe fail cause the function only
  work for TDengine enterprise version, you can run the script with below command:

  ```bash
  cd /root/TDengine/tests/system-test
  python3 ./test.py -f 2-query/floor.py
  ```

- Run unittest
  
  Unit test script is the smallest testable part and developed for some function, method or class of TDengine, you can run
  the script with below command:

  ```bash
  cd /root/TDengine/tests/unit-test/
  bash test.sh
  ```

- Smoke Testing
  
  Smoke test script is known as sanity testing to ensure that the critical functionalities of TDengine, you can run the 
  script with below command:

  ```bash
  cd /root/TDengine/packaging/smokeTest
  ./test_smoking_selfhost.sh
  ```

- TSBS Test --replace

  The Time Series Benchmark Suite(TSBS) test script provides a standardized approach to evaluate the performance of various
  time series databases, you can run the script with below command:

  Clone the code

    ```bash
    cd /root && git clone https://github.com/taosdata/tsbs.git && cd tsbs/scripts/tsdbComp
    ```

  Modify IP and host of client and server in `test.ini`
    ```ini
    clientIP="192.168.0.203"   # client ip
    clientHost="trd03"         # client hostname
    serverIP="192.168.0.204"   # server ip
    serverHost="trd04"         # server hostname
    ```
   
  Set up passwordless login between the client and server; otherwise, you'll need to configure the server password:

    ```ini
    serverPass="taosdata123"   # server root password
    ```

  Run the following command to start the test:
    ```bash
    nohup bash tsdbComparison.sh > test.log &
    ```
  When the test is done, the result can be found in `/data2/` directory, which can also be configured in `test.ini`.

- Crash_gen Test
  
  Crash_gen is a chaotic testing tool developed by TDengine, it can evaluate the resilience of TDengine through simulating 
  normal operation、intentional fault injection and their combination, you can run the script with below command:

  ```bash
  cd /root/TDengine/tests/pytest/ && ./crash_gen.sh
  ```

Windows platform testing

  to be updated...

MacOS platform testing

  to be updated...

# 9. Releasing

You can access the [Release](https://github.com/taosdata/TDengine/releases) for TDengine release version list.

# 10. CI/CD 
You can run ci script locally with below commands:

```bash
cd /root/TDengine/tests
./run_all_ci_cases.sh -b main
```

# 11. Coverage --replace
You can see coverage result in https://coveralls.io/github/taosdata/TDengine
You can also run coverage script locally.

```bash
cd /root/TDengine/tests
./run_local_coverage.sh
```

# 12. Contributing

Please follow the [contribution guidelines](CONTRIBUTING.md) to contribute to the project.
