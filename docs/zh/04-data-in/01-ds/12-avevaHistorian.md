---
sidebar_label: AVEVA Historian
title: “AVEVA Historian”数据源
description: 使用“AVEVA Historian”数据源导入数据到 TDengine Cloud 的实例
---

AVEVA Historian 数据写入，是通过连接代理把数据从 AVEVA Historian 服务器写入到当前选择的 TDengine Cloud 实例。

## 先决条件

- 创建一个空数据库来存储 AVEVA Historian 数据。更多信息，请参阅 [数据库](../../../programming/model/#create-database)。
- 确保连接代理运行在与 AVEVA Historian 服务器位于同一网络的机器上。更多信息，请参阅 [安装连接代理](../install-agent/)。

## 具体步骤

1. 在 TDengine Cloud 中，在左边菜单中打开 **数据写入** 页面，在 **数据源** 选项卡上，单击 **添加数据源**打开新增页面。在**名称**输入框里面填写这个数据源的名称，并选择 **AVEVA Historian** 类型，在**代理**选择框里面选择已经创建的代理，如果没有创建代理，请点击旁边的**创建新的代理**按钮去创建新代理。
2. 在**目标数据库**里面选择一个当前所在的 TDengine Cloud 实例里面的数据库作为目标数据库。
3. 配置连接信息：
   - 在 **连接配置** 区域填写 **Server 地址** 和 **Server 端口**。
   - 在 **认证** 区域填写 **用户名** 和 **密码**。
4. 点击 **连通性检查** 按钮，检查数据源是否可用。
5. 在 **采集配置** 区域填写采集任务相关的配置参数：
   - 在 **采集模式** 下拉列表中选择 **migrate**。
   - 在 **标签** 中，填写要迁移的标签列表，以逗号（,）分隔。
   - 在 **标签组大小** 中，填写标签组的大小。
   - 在 **任务开始时间** 中，填写数据迁移任务的开始时间。
   - 在 **任务结束时间** 中，填写数据迁移任务的结束时间。
   - 在 **查询的时间窗口** 中，填写一个时间间隔，数据迁移任务将按照这个时间间隔划分时间窗口。
6. 如果要同步 **Runtime.dbo.History** 表中的数据到 TDengine，需要配置以下参数：
   - 在 **采集模式** 下拉列表中选择 **synchronize**。
   - 在 **表** 中选择 **Runtime.dbo.History**。
   - 在 **标签** 中，填写要迁移的标签列表，以逗号（,）分隔。
   - 在 **标签组大小** 中，填写标签组的大小。
   - 在 **任务开始时间** 中，填写数据迁移任务的开始时间。
   - 在 **查询的时间窗口** 中，填写一个时间间隔，历史数据部分将按照这个时间间隔划分时间窗口。
   - 在 **实时同步的时间间隔** 中，填写一个时间间隔，实时数据部分将按照这个时间间隔轮询数据。
   - 在 **乱序时间上限** 中，填写一个时间间隔，实时数据同步过程中，超过这个时间才入库的数据可能会丢失。
7. 如果要同步 **Runtime.dbo.Live** 表中的数据到 TDengine，需要配置以下参数：
   - 在 **采集模式** 下拉列表中选择 **synchronize**。
   - 在 **表** 中选择 **Runtime.dbo.Live**。
   - 在 **标签** 中，填写要迁移的标签列表，以逗号（,）分隔。
   - 在 **实时同步的时间间隔** 中，填写一个时间间隔，实时数据部分将按照这个时间间隔轮询数据。
8. 在 **数据映射** 区域填写数据映射相关的配置参数：
   - 点击 **从服务器检索** 按钮，从 AVEVA Historian 服务器获取示例数据。
   - 在 **从列中提取或拆分** 中填写从消息体中提取或拆分的字段，例如：将 vValue 字段拆分成 `vValue_0` 和 `vValue_1` 这 2 个字段，选择 split 提取器，separator 填写分割符 `,`, number 填写 2。
   - 在 **过滤** 中，填写过滤条件，例如：填写`Value > 0`，则只有 Value 大于 0 的数据才会被写入 TDengine。
   - 在 **映射** 中，选择要映射到 TDengine 的超级表，以及映射到超级表的列。点击 **预览**，可以查看映射的结果。
9. 在**高级选项**卡片，可以配置以下信息：
   - 在 **最大读取并发数** 中设置最大读取并发数。默认值：0，表示 auto，自动配置并发数。
   - 在 **批次大小** 中设置每次写入的批次大小，即：单次发送的最大消息数量。
   - 在 **保存原始数据** 中选择是否保存原始数据。默认值：否。当保存原始数据时，以下 2 个参数配置生效。
   - 在 **最大保留天数** 中设置原始数据的最大保留天数。
   - 在 **原始数据存储目录** 中设置原始数据保存路径。
10. 填写完以上信息后，点击 **提交** 按钮，即可启动从 OpenTSDB 到 TDengine 的数据同步。
